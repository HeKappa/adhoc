{"ast":null,"code":"// frontend/src/pages/TradeInterface.js\nimport React,{useEffect,useState}from'react';import axios from'axios';import{useSocket}from'../contexts/SocketContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function TradeInterface(){const{socket,onlineUsers}=useSocket();const username=localStorage.getItem('username');const[listings,setListings]=useState([]);const[availableProducts,setAvailableProducts]=useState([]);const[selectedListing,setSelectedListing]=useState(null);const[selectedProduct,setSelectedProduct]=useState('');useEffect(()=>{fetchListings();fetchAvailableProducts();},[]);const fetchListings=async()=>{try{const res=await axios.get('http://localhost:5000/api/trade-listings');// Exclude own listings\nconst otherListings=res.data.filter(listing=>listing.postedBy!==username);setListings(otherListings);console.log('Fetched Listings:',otherListings);}catch(error){console.error('Error fetching listings:',error);}};const fetchAvailableProducts=async()=>{try{const res=await axios.get('http://localhost:5000/api/products');const myProducts=res.data.filter(product=>product.offeredBy===username);setAvailableProducts(myProducts);console.log('Fetched Available Products:',myProducts);}catch(error){console.error('Error fetching products:',error);}};const handleListingClick=listing=>{if(onlineUsers[listing.postedBy]){setSelectedListing(listing);console.log(`Selected Listing: ${listing._id}`);}};const handleSendTradeRequest=()=>{if(!selectedProduct){alert('Please select a product to offer.');return;}const tradeRequest={sender:username,receiver:selectedListing.postedBy,listingId:selectedListing._id,offeredProduct:selectedProduct,description:`Trade for ${selectedListing.product}`};socket.emit('sendTradeRequest',tradeRequest);console.log('Sent Trade Request:',tradeRequest);alert('Trade request sent!');setSelectedListing(null);setSelectedProduct('');};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl mb-4\",children:\"Trade Interface\"}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-3 gap-4\",children:listings.map(listing=>{const isOnline=onlineUsers[listing.postedBy];return/*#__PURE__*/_jsxs(\"div\",{className:`p-4 border rounded cursor-pointer ${isOnline?'bg-green-100':'bg-gray-200 cursor-not-allowed'}`,onClick:()=>isOnline&&handleListingClick(listing),children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg\",children:listing.product}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Posted By: \",listing.postedBy]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Price: \",listing.price]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Shipping: \",listing.shippingOptions]}),/*#__PURE__*/_jsx(\"p\",{children:listing.description}),/*#__PURE__*/_jsx(\"span\",{className:`inline-block mt-2 px-2 py-1 text-xs rounded ${isOnline?'bg-green-500 text-white':'bg-gray-500 text-white'}`,children:isOnline?'Online':'Offline'})]},listing._id);})}),selectedListing&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg mb-4\",children:[\"Trade with \",selectedListing.postedBy]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Listing: \",selectedListing.product]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block mb-1\",children:\"Select Product to Offer\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedProduct,onChange:e=>setSelectedProduct(e.target.value),className:\"w-full px-3 py-2 border rounded\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select Product\"}),availableProducts.map(prod=>/*#__PURE__*/_jsx(\"option\",{value:prod.name,children:prod.name},prod._id))]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSendTradeRequest,className:\"mt-4 px-4 py-2 bg-blue-500 text-white rounded\",children:\"Send Trade Request\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedListing(null),className:\"mt-2 px-4 py-2 bg-red-500 text-white rounded\",children:\"Cancel\"})]})})]});}export default TradeInterface;","map":{"version":3,"names":["React","useEffect","useState","axios","useSocket","jsx","_jsx","jsxs","_jsxs","TradeInterface","socket","onlineUsers","username","localStorage","getItem","listings","setListings","availableProducts","setAvailableProducts","selectedListing","setSelectedListing","selectedProduct","setSelectedProduct","fetchListings","fetchAvailableProducts","res","get","otherListings","data","filter","listing","postedBy","console","log","error","myProducts","product","offeredBy","handleListingClick","_id","handleSendTradeRequest","alert","tradeRequest","sender","receiver","listingId","offeredProduct","description","emit","children","className","map","isOnline","onClick","price","shippingOptions","value","onChange","e","target","prod","name"],"sources":["C:/Users/critis1/Desktop/Projects/ad_hoc/adhoc_final/frontend/src/pages/TradeInterface.js"],"sourcesContent":["// frontend/src/pages/TradeInterface.js\r\nimport React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport { useSocket } from '../contexts/SocketContext'; \r\n\r\nfunction TradeInterface() {\r\n    const { socket, onlineUsers } = useSocket();\r\n    const username = localStorage.getItem('username');\r\n    const [listings, setListings] = useState([]);\r\n    const [availableProducts, setAvailableProducts] = useState([]);\r\n    const [selectedListing, setSelectedListing] = useState(null);\r\n    const [selectedProduct, setSelectedProduct] = useState('');\r\n\r\n    useEffect(() => {\r\n        fetchListings();\r\n        fetchAvailableProducts();\r\n    }, []);\r\n\r\n    const fetchListings = async () => {\r\n        try {\r\n            const res = await axios.get('http://localhost:5000/api/trade-listings');\r\n            // Exclude own listings\r\n            const otherListings = res.data.filter(listing => listing.postedBy !== username);\r\n            setListings(otherListings);\r\n            console.log('Fetched Listings:', otherListings);\r\n        } catch (error) {\r\n            console.error('Error fetching listings:', error);\r\n        }\r\n    };\r\n\r\n    const fetchAvailableProducts = async () => {\r\n        try {\r\n            const res = await axios.get('http://localhost:5000/api/products');\r\n            const myProducts = res.data.filter(product => product.offeredBy === username);\r\n            setAvailableProducts(myProducts);\r\n            console.log('Fetched Available Products:', myProducts);\r\n        } catch (error) {\r\n            console.error('Error fetching products:', error);\r\n        }\r\n    };\r\n\r\n    const handleListingClick = (listing) => {\r\n        if (onlineUsers[listing.postedBy]) {\r\n            setSelectedListing(listing);\r\n            console.log(`Selected Listing: ${listing._id}`);\r\n        }\r\n    };\r\n\r\n    const handleSendTradeRequest = () => {\r\n        if (!selectedProduct) {\r\n            alert('Please select a product to offer.');\r\n            return;\r\n        }\r\n\r\n        const tradeRequest = {\r\n            sender: username,\r\n            receiver: selectedListing.postedBy,\r\n            listingId: selectedListing._id,\r\n            offeredProduct: selectedProduct,\r\n            description: `Trade for ${selectedListing.product}`\r\n        };\r\n\r\n        socket.emit('sendTradeRequest', tradeRequest);\r\n        console.log('Sent Trade Request:', tradeRequest);\r\n        alert('Trade request sent!');\r\n        setSelectedListing(null);\r\n        setSelectedProduct('');\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <h2 className=\"text-xl mb-4\">Trade Interface</h2>\r\n            <div className=\"grid grid-cols-3 gap-4\">\r\n                {listings.map(listing => {\r\n                    const isOnline = onlineUsers[listing.postedBy];\r\n                    return (\r\n                        <div\r\n                            key={listing._id}\r\n                            className={`p-4 border rounded cursor-pointer ${isOnline ? 'bg-green-100' : 'bg-gray-200 cursor-not-allowed'}`}\r\n                            onClick={() => isOnline && handleListingClick(listing)}\r\n                        >\r\n                            <h3 className=\"text-lg\">{listing.product}</h3>\r\n                            <p>Posted By: {listing.postedBy}</p>\r\n                            <p>Price: {listing.price}</p>\r\n                            <p>Shipping: {listing.shippingOptions}</p>\r\n                            <p>{listing.description}</p>\r\n                            <span className={`inline-block mt-2 px-2 py-1 text-xs rounded ${isOnline ? 'bg-green-500 text-white' : 'bg-gray-500 text-white'}`}>\r\n                                {isOnline ? 'Online' : 'Offline'}\r\n                            </span>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Trade Request Modal */}\r\n            {selectedListing && (\r\n                <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50\">\r\n                    <div className=\"bg-white p-6 rounded\">\r\n                        <h3 className=\"text-lg mb-4\">Trade with {selectedListing.postedBy}</h3>\r\n                        <p>Listing: {selectedListing.product}</p>\r\n                        <div className=\"mt-4\">\r\n                            <label className=\"block mb-1\">Select Product to Offer</label>\r\n                            <select\r\n                                value={selectedProduct}\r\n                                onChange={(e) => setSelectedProduct(e.target.value)}\r\n                                className=\"w-full px-3 py-2 border rounded\"\r\n                            >\r\n                                <option value=\"\">Select Product</option>\r\n                                {availableProducts.map(prod => (\r\n                                    <option key={prod._id} value={prod.name}>{prod.name}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleSendTradeRequest}\r\n                            className=\"mt-4 px-4 py-2 bg-blue-500 text-white rounded\"\r\n                        >\r\n                            Send Trade Request\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setSelectedListing(null)}\r\n                            className=\"mt-2 px-4 py-2 bg-red-500 text-white rounded\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Optional: Display Online Users for Debugging */}\r\n            {/* <OnlineUsersDebug /> */}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default TradeInterface;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}